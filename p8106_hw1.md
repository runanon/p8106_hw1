P8106 HW 1
================

### Problem

``` r
library(tidyverse)
library(ISLR)
library(glmnet)
library(caret)
library(corrplot)
library(plotmo)
library(pls)
```

``` r
train = read.csv("./data/solubility_train.csv")
test= read.csv("./data/solubility_test.csv")
```

\*\* (a) Fit a linear model using least squares on the training data and calculate the mean square error using the test data.\*\*

*1) Fit a linear model*

``` r
# Fit model using train data
fit1 = lm(Solubility ~ ., data = train)
summary(fit1)
```

    ## 
    ## Call:
    ## lm(formula = Solubility ~ ., data = train)
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -1.75620 -0.28304  0.01165  0.30030  1.54887 
    ## 
    ## Coefficients:
    ##                     Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept)        2.431e+00  2.162e+00   1.124 0.261303    
    ## FP001              3.594e-01  3.185e-01   1.128 0.259635    
    ## FP002              1.456e-01  2.637e-01   0.552 0.580960    
    ## FP003             -3.969e-02  1.314e-01  -0.302 0.762617    
    ## FP004             -3.049e-01  1.371e-01  -2.223 0.026520 *  
    ## FP005              2.837e+00  9.598e-01   2.956 0.003223 ** 
    ## FP006             -6.886e-02  2.041e-01  -0.337 0.735917    
    ## FP007              4.044e-02  1.152e-01   0.351 0.725643    
    ## FP008              1.121e-01  1.636e-01   0.685 0.493331    
    ## FP009             -8.242e-01  8.395e-01  -0.982 0.326536    
    ## FP010              4.193e-01  3.136e-01   1.337 0.181579    
    ## FP011              5.158e-02  2.198e-01   0.235 0.814503    
    ## FP012             -1.346e-02  1.611e-01  -0.084 0.933452    
    ## FP013             -4.519e-01  5.473e-01  -0.826 0.409311    
    ## FP014              3.281e-01  4.550e-01   0.721 0.471044    
    ## FP015             -1.839e-01  1.521e-01  -1.209 0.226971    
    ## FP016             -1.367e-01  1.548e-01  -0.883 0.377340    
    ## FP017             -1.704e-01  1.386e-01  -1.230 0.219187    
    ## FP018             -3.824e-01  2.388e-01  -1.602 0.109655    
    ## FP019             -3.131e-01  3.863e-01  -0.811 0.417862    
    ## FP020              2.072e-01  2.135e-01   0.971 0.332078    
    ## FP021             -5.956e-02  2.632e-01  -0.226 0.821060    
    ## FP022              2.336e-01  3.456e-01   0.676 0.499180    
    ## FP023             -3.193e-01  1.909e-01  -1.672 0.094866 .  
    ## FP024             -4.272e-01  2.827e-01  -1.511 0.131162    
    ## FP025              4.376e-01  4.538e-01   0.964 0.335184    
    ## FP026              2.068e-01  2.564e-01   0.806 0.420273    
    ## FP027              2.424e-01  2.429e-01   0.998 0.318594    
    ## FP028              1.070e-01  1.200e-01   0.892 0.372547    
    ## FP029             -9.857e-02  2.199e-01  -0.448 0.654163    
    ## FP030             -2.361e-01  2.468e-01  -0.957 0.339048    
    ## FP031              8.690e-02  1.346e-01   0.646 0.518754    
    ## FP032             -1.204e+00  7.772e-01  -1.550 0.121628    
    ## FP033              5.766e-01  4.236e-01   1.361 0.173882    
    ## FP034             -1.794e-01  2.618e-01  -0.685 0.493486    
    ## FP035             -2.140e-01  1.704e-01  -1.256 0.209605    
    ## FP036              7.701e-02  1.657e-01   0.465 0.642133    
    ## FP037              1.098e-01  1.725e-01   0.636 0.524693    
    ## FP038              2.721e-01  1.888e-01   1.441 0.150030    
    ## FP039              2.011e-02  2.888e-01   0.070 0.944491    
    ## FP040              5.477e-01  1.890e-01   2.898 0.003873 ** 
    ## FP041             -4.265e-01  3.004e-01  -1.420 0.156143    
    ## FP042             -9.901e-01  7.078e-01  -1.399 0.162294    
    ## FP043             -3.725e-02  2.096e-01  -0.178 0.859011    
    ## FP044             -3.860e-01  2.184e-01  -1.768 0.077562 .  
    ## FP045              2.120e-01  1.299e-01   1.631 0.103238    
    ## FP046             -3.504e-02  2.733e-01  -0.128 0.898010    
    ## FP047             -1.675e-02  1.414e-01  -0.118 0.905775    
    ## FP048              2.610e-01  2.434e-01   1.073 0.283810    
    ## FP049              1.241e-01  1.971e-01   0.630 0.529036    
    ## FP050              9.087e-03  1.410e-01   0.064 0.948648    
    ## FP051              1.050e-01  2.014e-01   0.521 0.602210    
    ## FP052             -4.569e-01  2.482e-01  -1.841 0.066029 .  
    ## FP053              2.994e-01  2.466e-01   1.214 0.225129    
    ## FP054              2.734e-02  1.829e-01   0.149 0.881229    
    ## FP055             -3.662e-01  1.970e-01  -1.858 0.063530 .  
    ## FP056             -2.961e-01  2.979e-01  -0.994 0.320541    
    ## FP057             -1.002e-01  1.379e-01  -0.727 0.467703    
    ## FP058              3.100e-01  8.074e-01   0.384 0.701129    
    ## FP059             -1.615e-01  1.690e-01  -0.956 0.339514    
    ## FP060              2.350e-01  1.474e-01   1.595 0.111209    
    ## FP061             -6.365e-01  1.440e-01  -4.421 1.13e-05 ***
    ## FP062             -5.224e-01  2.961e-01  -1.764 0.078078 .  
    ## FP063             -2.001e+00  1.287e+00  -1.554 0.120553    
    ## FP064              2.549e-01  1.221e-01   2.087 0.037207 *  
    ## FP065             -2.844e-01  1.197e-01  -2.377 0.017714 *  
    ## FP066              2.093e-01  1.264e-01   1.655 0.098301 .  
    ## FP067             -1.406e-01  1.540e-01  -0.913 0.361631    
    ## FP068              4.964e-01  2.028e-01   2.447 0.014630 *  
    ## FP069              1.324e-01  8.824e-02   1.501 0.133885    
    ## FP070              3.453e-03  8.088e-02   0.043 0.965963    
    ## FP071              1.474e-01  1.237e-01   1.192 0.233775    
    ## FP072             -9.773e-01  2.763e-01  -3.537 0.000431 ***
    ## FP073             -4.671e-01  2.072e-01  -2.254 0.024474 *  
    ## FP074              1.793e-01  1.206e-01   1.487 0.137566    
    ## FP075              1.231e-01  1.035e-01   1.188 0.235034    
    ## FP076              5.166e-01  1.704e-01   3.031 0.002525 ** 
    ## FP077              1.644e-01  1.236e-01   1.331 0.183739    
    ## FP078             -3.715e-01  1.588e-01  -2.339 0.019608 *  
    ## FP079              4.254e-01  1.881e-01   2.262 0.023992 *  
    ## FP080              3.101e-01  1.554e-01   1.996 0.046340 *  
    ## FP081             -3.208e-01  1.117e-01  -2.873 0.004192 ** 
    ## FP082              1.243e-01  9.524e-02   1.305 0.192379    
    ## FP083             -6.916e-01  2.134e-01  -3.241 0.001248 ** 
    ## FP084              3.626e-01  2.381e-01   1.523 0.128171    
    ## FP085             -3.310e-01  1.428e-01  -2.317 0.020785 *  
    ## FP086              1.169e-02  9.774e-02   0.120 0.904834    
    ## FP087              4.559e-02  2.797e-01   0.163 0.870568    
    ## FP088              2.416e-01  9.959e-02   2.425 0.015534 *  
    ## FP089              5.999e-01  2.320e-01   2.586 0.009915 ** 
    ## FP090             -2.450e-02  1.154e-01  -0.212 0.831930    
    ## FP091             -2.858e-01  3.185e-01  -0.897 0.369847    
    ## FP092              2.665e-01  2.069e-01   1.288 0.198156    
    ## FP093              1.974e-01  1.087e-01   1.816 0.069803 .  
    ## FP094             -1.991e-01  1.441e-01  -1.381 0.167707    
    ## FP095             -1.403e-01  1.124e-01  -1.248 0.212449    
    ## FP096             -5.024e-01  1.459e-01  -3.445 0.000605 ***
    ## FP097             -2.635e-01  1.666e-01  -1.582 0.114020    
    ## FP098             -2.865e-01  1.633e-01  -1.754 0.079863 .  
    ## FP099              2.592e-01  2.568e-01   1.009 0.313136    
    ## FP100             -4.008e-01  3.034e-01  -1.321 0.186949    
    ## FP101             -1.760e-01  3.019e-01  -0.583 0.560147    
    ## FP102              2.445e-01  3.449e-01   0.709 0.478579    
    ## FP103             -1.493e-01  9.148e-02  -1.632 0.103176    
    ## FP104             -1.428e-01  1.176e-01  -1.214 0.225238    
    ## FP105             -6.912e-02  1.395e-01  -0.495 0.620482    
    ## FP106              1.128e-01  1.288e-01   0.876 0.381495    
    ## FP107              2.778e+00  8.247e-01   3.369 0.000796 ***
    ## FP108              8.836e-03  1.852e-01   0.048 0.961970    
    ## FP109              8.200e-01  2.267e-01   3.617 0.000319 ***
    ## FP110              3.680e-01  3.311e-01   1.111 0.266811    
    ## FP111             -5.565e-01  1.420e-01  -3.918 9.80e-05 ***
    ## FP112             -1.079e-01  2.705e-01  -0.399 0.690108    
    ## FP113              1.511e-01  9.481e-02   1.594 0.111478    
    ## FP114             -1.201e-01  1.891e-01  -0.635 0.525628    
    ## FP115             -1.896e-01  1.405e-01  -1.349 0.177736    
    ## FP116              7.778e-03  1.897e-01   0.041 0.967300    
    ## FP117              2.583e-01  1.779e-01   1.452 0.147070    
    ## FP118             -1.964e-01  1.230e-01  -1.596 0.110940    
    ## FP119              7.515e-01  2.630e-01   2.857 0.004402 ** 
    ## FP120             -1.814e-01  1.794e-01  -1.011 0.312362    
    ## FP121             -4.731e-02  3.957e-01  -0.120 0.904866    
    ## FP122              1.048e-01  1.041e-01   1.007 0.314268    
    ## FP123              3.926e-02  1.765e-01   0.222 0.824066    
    ## FP124              1.235e-01  1.705e-01   0.724 0.469243    
    ## FP125             -2.633e-04  1.151e-01  -0.002 0.998175    
    ## FP126             -2.782e-01  1.177e-01  -2.363 0.018373 *  
    ## FP127             -6.123e-01  1.739e-01  -3.521 0.000457 ***
    ## FP128             -5.424e-01  1.932e-01  -2.807 0.005136 ** 
    ## FP129             -6.731e-02  2.243e-01  -0.300 0.764167    
    ## FP130             -1.034e+00  4.106e-01  -2.518 0.012009 *  
    ## FP131              2.158e-01  1.617e-01   1.335 0.182405    
    ## FP132             -1.976e-01  2.382e-01  -0.830 0.406998    
    ## FP133             -1.573e-01  1.217e-01  -1.293 0.196319    
    ## FP134              2.496e+00  1.196e+00   2.086 0.037310 *  
    ## FP135              1.818e-01  1.319e-01   1.379 0.168460    
    ## FP136             -7.763e-02  3.131e-01  -0.248 0.804237    
    ## FP137             -4.613e-02  2.978e-01  -0.155 0.876947    
    ## FP138             -9.392e-02  1.906e-01  -0.493 0.622251    
    ## FP139              7.659e-02  4.063e-01   0.189 0.850517    
    ## FP140              3.145e-01  2.149e-01   1.463 0.143784    
    ## FP141              2.219e-01  2.765e-01   0.802 0.422532    
    ## FP142              6.272e-01  1.488e-01   4.214 2.83e-05 ***
    ## FP143              9.981e-01  2.929e-01   3.407 0.000692 ***
    ## FP144              2.207e-01  2.839e-01   0.777 0.437195    
    ## FP145             -1.146e-01  1.188e-01  -0.964 0.335169    
    ## FP146             -2.324e-01  2.086e-01  -1.114 0.265716    
    ## FP147              1.502e-01  1.228e-01   1.223 0.221703    
    ## FP148             -1.600e-01  1.319e-01  -1.213 0.225560    
    ## FP149              1.172e-01  1.650e-01   0.710 0.477770    
    ## FP150              9.046e-02  1.577e-01   0.574 0.566368    
    ## FP151              2.899e-01  3.120e-01   0.929 0.353202    
    ## FP152             -2.544e-01  2.990e-01  -0.851 0.395087    
    ## FP153             -3.765e-01  2.773e-01  -1.358 0.175029    
    ## FP154             -1.027e+00  2.033e-01  -5.054 5.50e-07 ***
    ## FP155              4.888e-01  2.916e-01   1.676 0.094163 .  
    ## FP156             -3.602e-02  3.636e-01  -0.099 0.921109    
    ## FP157             -4.715e-01  2.468e-01  -1.910 0.056505 .  
    ## FP158              1.669e-02  1.925e-01   0.087 0.930943    
    ## FP159              1.800e-01  2.432e-01   0.740 0.459378    
    ## FP160              1.525e-02  2.177e-01   0.070 0.944155    
    ## FP161             -2.440e-01  1.433e-01  -1.703 0.089063 .  
    ## FP162              4.910e-02  1.859e-01   0.264 0.791710    
    ## FP163              4.785e-01  3.121e-01   1.533 0.125659    
    ## FP164              5.096e-01  1.899e-01   2.684 0.007446 ** 
    ## FP165              5.793e-01  2.146e-01   2.700 0.007103 ** 
    ## FP166             -6.582e-02  2.185e-01  -0.301 0.763293    
    ## FP167             -6.044e-01  2.515e-01  -2.403 0.016502 *  
    ## FP168             -1.187e-01  1.872e-01  -0.634 0.526173    
    ## FP169             -1.705e-01  8.312e-02  -2.051 0.040650 *  
    ## FP170             -7.902e-02  1.560e-01  -0.506 0.612745    
    ## FP171              4.651e-01  1.186e-01   3.922 9.64e-05 ***
    ## FP172             -4.426e-01  2.440e-01  -1.814 0.070120 .  
    ## FP173              4.243e-01  1.657e-01   2.561 0.010634 *  
    ## FP174             -1.010e-01  2.098e-01  -0.481 0.630311    
    ## FP175             -4.657e-02  2.481e-01  -0.188 0.851136    
    ## FP176              9.736e-01  2.644e-01   3.682 0.000249 ***
    ## FP177              1.386e-01  2.393e-01   0.579 0.562538    
    ## FP178              6.497e-02  2.079e-01   0.313 0.754691    
    ## FP179             -3.415e-02  2.232e-01  -0.153 0.878437    
    ## FP180             -7.905e-01  5.523e-01  -1.431 0.152839    
    ## FP181              4.925e-01  3.218e-01   1.531 0.126309    
    ## FP182             -1.124e-01  1.310e-01  -0.858 0.391384    
    ## FP183              2.998e-01  7.143e-01   0.420 0.674836    
    ## FP184              4.876e-01  1.580e-01   3.087 0.002103 ** 
    ## FP185             -3.778e-01  2.037e-01  -1.854 0.064108 .  
    ## FP186             -3.654e-01  1.953e-01  -1.871 0.061710 .  
    ## FP187              4.457e-01  2.682e-01   1.662 0.097015 .  
    ## FP188              1.475e-01  1.258e-01   1.172 0.241519    
    ## FP189             -1.984e-02  3.468e-01  -0.057 0.954384    
    ## FP190              2.629e-01  3.018e-01   0.871 0.383981    
    ## FP191              2.799e-01  1.465e-01   1.911 0.056388 .  
    ## FP192             -2.404e-01  2.751e-01  -0.874 0.382534    
    ## FP193              1.502e-01  1.494e-01   1.005 0.315159    
    ## FP194              8.029e-01  6.379e-01   1.259 0.208566    
    ## FP195              5.967e-02  3.435e-01   0.174 0.862158    
    ## FP196              1.091e-02  2.544e-01   0.043 0.965812    
    ## FP197             -3.736e-02  1.569e-01  -0.238 0.811793    
    ## FP198              1.896e-01  2.665e-01   0.712 0.476893    
    ## FP199             -9.932e-02  1.797e-01  -0.553 0.580702    
    ## FP200             -6.421e-02  2.161e-01  -0.297 0.766462    
    ## FP201             -4.838e-01  1.980e-01  -2.444 0.014771 *  
    ## FP202              5.664e-01  1.869e-01   3.031 0.002527 ** 
    ## FP203              2.586e-01  6.447e-01   0.401 0.688462    
    ## FP204             -1.371e-01  2.543e-01  -0.539 0.590008    
    ## FP205              7.177e-02  1.561e-01   0.460 0.645857    
    ## FP206             -6.769e-02  1.860e-01  -0.364 0.716094    
    ## FP207             -5.538e-03  2.060e-01  -0.027 0.978560    
    ## FP208             -5.338e-01  6.324e-01  -0.844 0.398925    
    ## MolWeight         -1.232e+00  2.296e-01  -5.365 1.09e-07 ***
    ## NumAtoms          -1.478e+01  3.473e+00  -4.257 2.35e-05 ***
    ## NumNonHAtoms       1.795e+01  3.166e+00   5.670 2.07e-08 ***
    ## NumBonds           9.843e+00  2.681e+00   3.671 0.000260 ***
    ## NumNonHBonds      -1.030e+01  1.793e+00  -5.746 1.35e-08 ***
    ## NumMultBonds       2.107e-01  1.754e-01   1.201 0.229990    
    ## NumRotBonds       -5.213e-01  1.334e-01  -3.908 0.000102 ***
    ## NumDblBonds       -7.492e-01  3.163e-01  -2.369 0.018111 *  
    ## NumAromaticBonds  -2.364e+00  6.232e-01  -3.794 0.000161 ***
    ## NumHydrogen        8.347e-01  1.880e-01   4.439 1.04e-05 ***
    ## NumCarbon          1.730e-02  3.763e-01   0.046 0.963335    
    ## NumNitrogen        6.125e+00  3.045e+00   2.011 0.044645 *  
    ## NumOxygen          2.389e+00  4.523e-01   5.283 1.69e-07 ***
    ## NumSulfer         -8.508e+00  3.619e+00  -2.351 0.018994 *  
    ## NumChlorine       -7.449e+00  1.989e+00  -3.744 0.000195 ***
    ## NumHalogen         1.408e+00  2.109e+00   0.668 0.504615    
    ## NumRings           1.276e+00  6.716e-01   1.901 0.057731 .  
    ## HydrophilicFactor  1.099e-02  1.137e-01   0.097 0.922998    
    ## SurfaceArea1       8.825e-02  6.058e-02   1.457 0.145643    
    ## SurfaceArea2       9.555e-02  5.615e-02   1.702 0.089208 .  
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 0.5524 on 722 degrees of freedom
    ## Multiple R-squared:  0.9446, Adjusted R-squared:  0.9271 
    ## F-statistic: 54.03 on 228 and 722 DF,  p-value: < 2.2e-16

*2) MSE*

``` r
# MSE using test data
pred_va <- predict(fit1, test)
# validation set error
mean((pred_va-test$Solubility)^2)
```

    ## [1] 0.5558898

### (b) Fit a ridge regression model on the training data, with λ chosen by cross-validation. Report the test error.

Fit a ridge regression model

``` r
train <- na.omit(train)

x_train <- model.matrix(Solubility~., train)[,-1]
y_train <- train$Solubility

x_test <- model.matrix(Solubility~., test)[,-1]
y_test <- test$Solubility
```

``` r
# fit the ridge regression (alpha = 0) with a sequence of lambdas
ridge.mod <- glmnet(x_train, y_train, alpha=0, lambda = exp(seq(-5, 0, length=500)))
```

``` r
set.seed(1)
cv.ridge <- cv.glmnet(x_train, y_train, 
                      alpha = 0, 
                      lambda = exp(seq(-5, 0, length=500)), 
                      type.measure = "mse")

plot(cv.ridge)
```

![](p8106_hw1_files/figure-markdown_github/unnamed-chunk-7-1.png)

``` r
best.lambda <- cv.ridge$lambda.min
best.lambda # 0.06421676
```

    ## [1] 0.06421676

``` r
predict(ridge.mod, s = best.lambda, type="coefficients")
```

    ## 229 x 1 sparse Matrix of class "dgCMatrix"
    ##                               1
    ## (Intercept)        8.307482e+00
    ## FP001              3.363442e-02
    ## FP002              1.491471e-01
    ## FP003             -9.059204e-02
    ## FP004             -2.519904e-01
    ## FP005             -1.863694e-02
    ## FP006             -1.298363e-01
    ## FP007              2.286027e-02
    ## FP008              5.703097e-02
    ## FP009              8.864553e-03
    ## FP010              9.490659e-02
    ## FP011              1.271239e-01
    ## FP012             -8.148872e-02
    ## FP013             -1.006893e-01
    ## FP014              3.307163e-02
    ## FP015             -8.357901e-02
    ## FP016             -1.321549e-01
    ## FP017             -2.173551e-01
    ## FP018             -2.125842e-01
    ## FP019             -1.945496e-02
    ## FP020              1.646867e-01
    ## FP021             -1.200442e-03
    ## FP022              1.552153e-01
    ## FP023             -2.131285e-01
    ## FP024             -2.025888e-01
    ## FP025              6.126730e-02
    ## FP026              1.799849e-01
    ## FP027              2.401757e-01
    ## FP028              8.220662e-02
    ## FP029             -5.977053e-02
    ## FP030             -1.966562e-01
    ## FP031              1.835298e-01
    ## FP032             -3.189658e-01
    ## FP033              4.397429e-01
    ## FP034             -1.765300e-01
    ## FP035             -1.950324e-01
    ## FP036              8.172663e-03
    ## FP037              2.875842e-01
    ## FP038              1.826616e-01
    ## FP039             -4.231853e-01
    ## FP040              5.132560e-01
    ## FP041             -9.104038e-02
    ## FP042             -5.860953e-06
    ## FP043              1.025981e-02
    ## FP044             -2.703949e-01
    ## FP045              1.541197e-01
    ## FP046              1.005028e-01
    ## FP047             -5.372956e-02
    ## FP048              7.971904e-02
    ## FP049              3.051832e-01
    ## FP050             -1.103065e-01
    ## FP051             -7.477192e-03
    ## FP052             -1.839581e-01
    ## FP053              3.362280e-01
    ## FP054             -8.529506e-02
    ## FP055             -2.660334e-01
    ## FP056             -5.409288e-02
    ## FP057             -1.219595e-01
    ## FP058              5.783913e-02
    ## FP059             -2.869430e-01
    ## FP060              1.163566e-01
    ## FP061             -1.207794e-01
    ## FP062              5.919107e-02
    ## FP063              2.348234e-01
    ## FP064              2.039074e-01
    ## FP065             -1.642263e-01
    ## FP066              1.352995e-01
    ## FP067             -1.274155e-01
    ## FP068              1.287906e-01
    ## FP069              1.624803e-01
    ## FP070             -1.563836e-01
    ## FP071              1.698174e-01
    ## FP072              2.412720e-01
    ## FP073             -2.155869e-01
    ## FP074              9.468327e-02
    ## FP075              2.395009e-01
    ## FP076              1.518759e-01
    ## FP077              1.345920e-01
    ## FP078             -9.716247e-02
    ## FP079              2.248807e-01
    ## FP080              1.470939e-01
    ## FP081             -2.042388e-01
    ## FP082              1.559031e-01
    ## FP083             -3.419178e-01
    ## FP084              2.059483e-01
    ## FP085             -3.484119e-01
    ## FP086             -7.012175e-02
    ## FP087              1.099883e-01
    ## FP088              1.674748e-01
    ## FP089             -8.816885e-02
    ## FP090             -6.087542e-02
    ## FP091              5.938292e-02
    ## FP092              1.024862e-01
    ## FP093              1.607840e-01
    ## FP094             -1.404858e-01
    ## FP095              2.432362e-02
    ## FP096             -9.944595e-03
    ## FP097              1.199157e-01
    ## FP098             -7.906271e-02
    ## FP099              2.173270e-01
    ## FP100             -1.204482e-01
    ## FP101              5.115674e-02
    ## FP102              1.651740e-01
    ## FP103             -1.425170e-01
    ## FP104             -1.325199e-01
    ## FP105             -9.656667e-02
    ## FP106              5.205477e-02
    ## FP107              6.577602e-02
    ## FP108              7.249849e-02
    ## FP109              3.597982e-01
    ## FP110              9.137901e-02
    ## FP111             -4.181643e-01
    ## FP112             -1.131279e-01
    ## FP113              1.149511e-01
    ## FP114              1.331078e-01
    ## FP115              1.022073e-01
    ## FP116              1.586175e-01
    ## FP117             -7.156760e-02
    ## FP118             -1.803568e-01
    ## FP119              3.557583e-01
    ## FP120             -1.273336e-01
    ## FP121             -1.383751e-01
    ## FP122              1.973050e-01
    ## FP123              1.988753e-02
    ## FP124              2.182542e-01
    ## FP125              1.007290e-01
    ## FP126             -3.186645e-01
    ## FP127             -3.879589e-01
    ## FP128             -2.855553e-01
    ## FP129              3.013523e-02
    ## FP130             -4.030107e-01
    ## FP131              3.197734e-01
    ## FP132             -1.081442e-01
    ## FP133             -1.714455e-01
    ## FP134             -8.372930e-02
    ## FP135              1.666321e-01
    ## FP136              5.952555e-02
    ## FP137              5.113674e-02
    ## FP138              1.676164e-01
    ## FP139              3.207289e-02
    ## FP140              1.678490e-01
    ## FP141             -9.519955e-02
    ## FP142              3.994514e-01
    ## FP143              4.288714e-01
    ## FP144              3.452898e-02
    ## FP145             -1.834184e-01
    ## FP146             -9.725686e-02
    ## FP147              2.534709e-01
    ## FP148             -3.166636e-02
    ## FP149             -8.481490e-03
    ## FP150              1.617910e-01
    ## FP151              1.293354e-01
    ## FP152              3.415445e-02
    ## FP153             -1.277406e-01
    ## FP154             -4.386079e-01
    ## FP155              1.903072e-01
    ## FP156             -3.320618e-01
    ## FP157             -3.400868e-02
    ## FP158             -3.018567e-02
    ## FP159              2.972748e-01
    ## FP160             -1.576429e-01
    ## FP161             -1.064150e-01
    ## FP162              7.033623e-02
    ## FP163              2.829509e-01
    ## FP164              3.412628e-01
    ## FP165              4.355489e-02
    ## FP166              5.551728e-02
    ## FP167             -2.293980e-01
    ## FP168             -9.399180e-02
    ## FP169             -1.810692e-01
    ## FP170              3.918784e-02
    ## FP171              3.240005e-01
    ## FP172             -3.938611e-01
    ## FP173              3.950698e-01
    ## FP174             -1.836915e-01
    ## FP175             -3.993275e-02
    ## FP176              4.450343e-01
    ## FP177              4.357445e-02
    ## FP178              4.098414e-02
    ## FP179              4.897661e-02
    ## FP180             -1.841215e-01
    ## FP181              1.659215e-01
    ## FP182             -7.428277e-02
    ## FP183             -3.662854e-02
    ## FP184              3.470362e-01
    ## FP185             -1.089537e-01
    ## FP186             -3.157136e-01
    ## FP187              2.043155e-01
    ## FP188              2.262384e-01
    ## FP189              4.648519e-02
    ## FP190              2.554523e-01
    ## FP191              9.383889e-02
    ## FP192              7.760620e-02
    ## FP193             -1.042106e-02
    ## FP194              5.359588e-02
    ## FP195             -3.215066e-02
    ## FP196              8.480522e-02
    ## FP197              4.130612e-03
    ## FP198              2.476446e-01
    ## FP199              7.825451e-03
    ## FP200             -8.303650e-02
    ## FP201             -3.354084e-01
    ## FP202              3.034901e-01
    ## FP203              6.242619e-02
    ## FP204             -8.832326e-02
    ## FP205             -9.413925e-02
    ## FP206             -3.859125e-02
    ## FP207             -9.240964e-02
    ## FP208             -2.240938e-02
    ## MolWeight         -1.243854e+00
    ## NumAtoms          -4.280562e-01
    ## NumNonHAtoms      -6.624989e-01
    ## NumBonds          -3.573219e-01
    ## NumNonHBonds      -3.684059e-01
    ## NumMultBonds      -1.145042e-01
    ## NumRotBonds       -2.407890e-01
    ## NumDblBonds       -3.787183e-02
    ## NumAromaticBonds  -1.599873e-01
    ## NumHydrogen        1.231021e-01
    ## NumCarbon         -3.050441e-01
    ## NumNitrogen        4.346407e-01
    ## NumOxygen          4.741830e-01
    ## NumSulfer         -7.770964e-01
    ## NumChlorine       -8.595947e-01
    ## NumHalogen        -5.642297e-01
    ## NumRings          -3.666091e-01
    ## HydrophilicFactor  1.132216e-01
    ## SurfaceArea1       1.024772e-01
    ## SurfaceArea2       5.786573e-02

MSE

``` r
ridge.pred = predict(ridge.mod, s = best.lambda, newx = x_test)
mean((ridge.pred - y_test)^2) # 0.5125536
```

    ## [1] 0.5125536

### (c) Fit a lasso model on the training data, with λ chosen by cross-validation. Report the test error, along with the number of non-zero coefficient estimates.

Fit a lasso model

``` r
lasso.mod <- glmnet(x_train, y_train, alpha=1, lambda = exp(seq(-6, -2, length=500)))
```

``` r
set.seed(1)
cv.lasso <- cv.glmnet(x_train, y_train, alpha = 1, lambda = exp(seq(-6, -2, length=500)))
best.lambda <- cv.lasso$lambda.min #0.004522015
```

``` r
plot(cv.lasso)
```

![](p8106_hw1_files/figure-markdown_github/unnamed-chunk-12-1.png)

The number of non-zero coefficient estimates

``` r
lasso_coef = predict(cv.lasso, s="lambda.min", type="coefficients")
lasso_coef
```

    ## 229 x 1 sparse Matrix of class "dgCMatrix"
    ##                              1
    ## (Intercept)        7.305350647
    ## FP001              .          
    ## FP002              0.252101238
    ## FP003             -0.047398182
    ## FP004             -0.234044103
    ## FP005              .          
    ## FP006             -0.069337415
    ## FP007              .          
    ## FP008              .          
    ## FP009              .          
    ## FP010              .          
    ## FP011              .          
    ## FP012             -0.053705811
    ## FP013             -0.047263482
    ## FP014              .          
    ## FP015             -0.096404976
    ## FP016             -0.076214408
    ## FP017             -0.142336865
    ## FP018             -0.098558950
    ## FP019              .          
    ## FP020              0.090203107
    ## FP021              .          
    ## FP022              .          
    ## FP023             -0.143127652
    ## FP024             -0.105517838
    ## FP025              .          
    ## FP026              0.269024299
    ## FP027              0.302433461
    ## FP028              .          
    ## FP029              .          
    ## FP030             -0.157934610
    ## FP031              0.126697254
    ## FP032              .          
    ## FP033              0.113644438
    ## FP034             -0.004748761
    ## FP035             -0.134670726
    ## FP036              .          
    ## FP037              0.221432197
    ## FP038              0.068174208
    ## FP039             -0.426042727
    ## FP040              0.434108357
    ## FP041              .          
    ## FP042              .          
    ## FP043              0.047498282
    ## FP044             -0.303260623
    ## FP045              0.085927164
    ## FP046              .          
    ## FP047              .          
    ## FP048              .          
    ## FP049              0.294600469
    ## FP050             -0.158525630
    ## FP051              .          
    ## FP052              .          
    ## FP053              0.221429290
    ## FP054             -0.080143365
    ## FP055             -0.141535425
    ## FP056              .          
    ## FP057             -0.090075902
    ## FP058              .          
    ## FP059             -0.292812598
    ## FP060              .          
    ## FP061             -0.162748218
    ## FP062              .          
    ## FP063              0.127871781
    ## FP064              0.243260310
    ## FP065             -0.138589765
    ## FP066              0.044020487
    ## FP067              .          
    ## FP068              0.001512405
    ## FP069              0.128574552
    ## FP070             -0.082521403
    ## FP071              0.099644830
    ## FP072              .          
    ## FP073             -0.113112227
    ## FP074              0.105035563
    ## FP075              0.184665376
    ## FP076              0.173785986
    ## FP077              0.076619377
    ## FP078             -0.132340202
    ## FP079              0.191449359
    ## FP080              .          
    ## FP081             -0.197282549
    ## FP082              0.134581399
    ## FP083             -0.345738917
    ## FP084              0.242626219
    ## FP085             -0.328224847
    ## FP086             -0.009817021
    ## FP087              .          
    ## FP088              0.097946241
    ## FP089              .          
    ## FP090             -0.001777735
    ## FP091              0.015218859
    ## FP092              .          
    ## FP093              0.150433181
    ## FP094             -0.167502919
    ## FP095              .          
    ## FP096             -0.050421664
    ## FP097              .          
    ## FP098             -0.050967014
    ## FP099              0.185339643
    ## FP100              .          
    ## FP101              .          
    ## FP102              .          
    ## FP103             -0.111562195
    ## FP104             -0.083355828
    ## FP105             -0.057978035
    ## FP106              0.073839333
    ## FP107              .          
    ## FP108              .          
    ## FP109              0.318110883
    ## FP110              .          
    ## FP111             -0.359930371
    ## FP112             -0.002253468
    ## FP113              0.108218755
    ## FP114              .          
    ## FP115              .          
    ## FP116              0.035275225
    ## FP117              .          
    ## FP118             -0.097139022
    ## FP119              0.201911645
    ## FP120             -0.008841833
    ## FP121              .          
    ## FP122              0.205958483
    ## FP123              .          
    ## FP124              0.302396930
    ## FP125              0.051081368
    ## FP126             -0.161730906
    ## FP127             -0.500397840
    ## FP128             -0.232694219
    ## FP129              .          
    ## FP130             -0.288028270
    ## FP131              0.193474757
    ## FP132             -0.019509796
    ## FP133             -0.150886139
    ## FP134              .          
    ## FP135              0.184192470
    ## FP136              .          
    ## FP137              0.202048504
    ## FP138              0.231733875
    ## FP139              .          
    ## FP140              0.022189697
    ## FP141             -0.090906215
    ## FP142              0.449053722
    ## FP143              0.306283518
    ## FP144              .          
    ## FP145             -0.073436667
    ## FP146              .          
    ## FP147              0.148042381
    ## FP148             -0.047090146
    ## FP149              .          
    ## FP150              0.026025838
    ## FP151              .          
    ## FP152              .          
    ## FP153              .          
    ## FP154             -0.495967979
    ## FP155              0.033032804
    ## FP156             -0.226572788
    ## FP157             -0.059302510
    ## FP158              .          
    ## FP159              0.058365846
    ## FP160             -0.044967441
    ## FP161             -0.076293939
    ## FP162              .          
    ## FP163              0.181419333
    ## FP164              0.380185429
    ## FP165              .          
    ## FP166              0.018704731
    ## FP167             -0.098836707
    ## FP168              .          
    ## FP169             -0.144746327
    ## FP170              0.015952809
    ## FP171              0.245341886
    ## FP172             -0.544222172
    ## FP173              0.340674846
    ## FP174             -0.112352314
    ## FP175              .          
    ## FP176              0.394945815
    ## FP177              .          
    ## FP178              .          
    ## FP179              .          
    ## FP180             -0.086680864
    ## FP181              0.167194407
    ## FP182             -0.027135718
    ## FP183              .          
    ## FP184              0.302887774
    ## FP185              .          
    ## FP186             -0.199048278
    ## FP187              0.192835426
    ## FP188              0.208195974
    ## FP189              .          
    ## FP190              0.287147565
    ## FP191              0.077766899
    ## FP192              0.071161210
    ## FP193              .          
    ## FP194              .          
    ## FP195              .          
    ## FP196              .          
    ## FP197              .          
    ## FP198              0.149718503
    ## FP199              .          
    ## FP200              .          
    ## FP201             -0.292138795
    ## FP202              0.415172028
    ## FP203              0.070392345
    ## FP204              .          
    ## FP205              .          
    ## FP206             -0.057065994
    ## FP207              .          
    ## FP208              .          
    ## MolWeight         -1.356644825
    ## NumAtoms           .          
    ## NumNonHAtoms       .          
    ## NumBonds           .          
    ## NumNonHBonds      -0.920441237
    ## NumMultBonds      -0.148660012
    ## NumRotBonds       -0.226233338
    ## NumDblBonds        .          
    ## NumAromaticBonds  -0.075131343
    ## NumHydrogen        0.114111970
    ## NumCarbon         -0.681043572
    ## NumNitrogen        0.177326788
    ## NumOxygen          0.535554767
    ## NumSulfer         -0.245330768
    ## NumChlorine       -0.560208987
    ## NumHalogen         .          
    ## NumRings          -0.008772371
    ## HydrophilicFactor  .          
    ## SurfaceArea1       0.244266715
    ## SurfaceArea2       .

``` r
length(lasso_coef[lasso_coef != 0]) # the number of non-zero coefficients
```

    ## <sparse>[ <logic> ] : .M.sub.i.logical() maybe inefficient

    ## [1] 144

The number of non-zero coefficient is 144.

MSE

``` r
lasso.pred = predict(lasso.mod, s=best.lambda, newx = x_test)
mean((lasso.pred - y_test)^2) #0.4991321
```

    ## [1] 0.4991321

#### (d) Fit a PCR model on the training data, with M chosen by cross-validation. Report the test error, along with the value of M selected by cross-validation.

``` r
set.seed(1)
ctrl1 <- trainControl(method = "repeatedcv", number = 10, repeats = 5)
pcr.fit <- train(x_train, y_train,
                 method = "pcr",
                 tuneLength = length(train),
                 trControl = ctrl1,
                 preProc = c("center", "scale"))
pcr.fit$bestTune #158
```

    ##     ncomp
    ## 158   158

``` r
pcr.pred = predict.train(pcr.fit, x_test)
mean((pcr.pred-y_test)^2) #0.5490447
```

    ## [1] 0.5490447

#### (e) Briefly discuss the results obtained in (a)∼(d).
